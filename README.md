<!-- saved from url=(0043)https://zhuanlan.zhihu.com/p/649812960/edit -->写文章 - 知乎<style data-emotion-css="9mvwt1">:root{--zhc-padding-horizontal:20px;--zhc-padding-vertical:16px;--zhc-notification-top:75px;--app-padding:16px;--app-header-height:52px;--app-max-width:640px;--app-width:1000px;--app-font-size:15px;}</style>\!function\(e,t\)\{"object"==typeof exports\&\&"undefined"\!=typeof module\?t\(exports\):"function"==typeof define\&\&define.amd\?define\(\["exports"\],t\):t\(\(e=e||self\).webReporter=\{\}\)\}\(this,function\(e\)\{"use strict";var t=\{\},n=\!1,o=function\(\)\{var e,o,r,a,i;return n||\(e=document.querySelector\("script\[data-web-reporter-config\]"\),o=e\&\&e.dataset.webReporterConfig||"\{\}",r=JSON.parse\(o\),a=r.platform,i=r.project,t=\{platform:a,project:i\},n=\!0\),t\};function r\(e\)\{return a\(function\(\)\{return localStorage.getItem\(e\)\}\)\(\)\}function a\(e\)\{return function\(\)\{try\{return e.apply\(void 0,arguments\)\}catch\(e\)\{\}\}\}var i=a\(function\(e,t\)\{var n=\{platform:"web",project:o\(\).project,clientTimestamp:+new Date\};\!function\(e,t,n\)\{"1"===r\("weber:logenabled"\)\&\&console.log\("\[web-reporter\]\%o",\{type:e,base:t,data:n\}\)\}\(e,n,t\),function\(e,t\)\{var n=btoa\(JSON.stringify\(t\)\);if\("undefined"\!=typeof Blob\&\&window.navigator\&\&window.navigator.sendBeacon\)\{var o=new Blob\(\[n\],\{type:"text/plain"\}\);navigator.sendBeacon\(e,o\)\}else\{var r=new XMLHttpRequest;r.open\("POST",e\),r.withCredentials=\!1,r.setRequestHeader\("Content-Type","text/plain;charset=UTF-8"\),r.send\(n\)\}\}\(r\("weber:api"\)||"https://apm.zhihu.com/collector/web\_json",\{type:e,base:n,data:t\}\)\}\);e.report=i,Object.defineProperty\(e,"\_\_esModule",\{value:\!0\}\)\}\); \!function\(\)\{"use strict";\!function\(e,n\)\{var r=\[\];function t\(e\)\{return function\(\)\{r.push\(\[e,arguments\]\)\}\}n.Raven=\{captureException:t\("captureException"\),captureMessage:t\("captureMessage"\),captureBreadcrumb:t\("captureBreadcrumb"\)\};var a,o,c,i,s,u="undefined"\!=typeof DOMError;function d\(e\)\{var n=e instanceof Error||e instanceof ErrorEvent||u\&\&e instanceof DOMError||e instanceof DOMException;Raven.captureException\(n\?e:new Error\(e.message||e.reason\)\)\}n.addEventListener\("unhandledrejection",d\),n.addEventListener\("error",d,\!0\),a=e.src,o=e,c=function\(\)\{r.forEach\(function\(e\)\{var n;\(n=Raven\)\[e\[0\]\].apply\(n,e\[1\]\)\}\),n.removeEventListener\("unhandledrejection",d\),n.removeEventListener\("error",d,\!0\)\},i=document.head||document.getElementsByTagName\("head"\)\[0\],\(s=document.createElement\("script"\)\).crossOrigin=o.crossOrigin,s.dataset.sentryConfig=o\["data-sentry-config"\],s.onload=c,s.src=a,i.appendChild\(s\)\}\(\{"defer":true,"crossOrigin":"anonymous","src":"https://unpkg.zhimg.com/\@cfe/sentry-script\@1.3.1/dist/init.js","data-sentry-config":"\{\\"dsn\\":\\"https://2d8d764432cc4f6fb3bc78ab9528299d\@crash2.zhihu.com/1224\\",\\"sampleRate\\":0.1,\\"release\\":\\"1310-3d84e9db\\",\\"ignoreErrorNames\\":\[\\"NetworkError\\",\\"SecurityError\\"\],\\"ignoreErrorsPreset\\":\\"ReactApp\\",\\"tags\\":\{\\"app\_name\\":\\"heifetz\\"\}\}"\},window\)\}\(\); <style data-emotion-css="55n9hh">.css-55n9hh{position:fixed;top:0;right:0;left:0;z-index:101;display:none;height:2px;pointer-events:none;background:#1772F6;-webkit-transform:translateX(-100%);-ms-transform:translateX(-100%);transform:translateX(-100%);}</style><style data-emotion="css-global" /><style data-emotion-css="1l12z7y">.css-1l12z7y{box-shadow:0px 16px 32px rgba(0,0,0,0.04);}</style><style data-emotion-css="1hlrcxk">.css-1hlrcxk{-webkit-transition-property:fill;transition-property:fill;-webkit-transition-duration:0.25s;transition-duration:0.25s;-webkit-transition-timing-function:ease-in;transition-timing-function:ease-in;}</style><style data-emotion-css="icip60">.css-icip60{border-radius:2px;}</style><style data-emotion-css="fnnb9l">.css-fnnb9l{box-sizing:border-box;margin:0;min-width:0;max-width:100%;height:auto;background-color:#ffffff;width:30px;height:30px;border-radius:2px;}</style><style data-emotion-css="1losy9j">.css-1losy9j{margin-top:0;width:100%;background:#f8f8fa;}</style><style data-emotion-css="77279f">.css-77279f{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin:0 auto;background:#ffffff;}</style><style data-emotion-css="1ykdma4">.css-1ykdma4{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}</style><style data-emotion-css="10r8x72">.css-10r8x72{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;overflow-x:auto;padding:10px 0 10px 20px;box-shadow:0px -0.5px 0px 0px rgba(235,235,235,1) inset;}</style><style data-emotion-css="5jm82r">.css-5jm82r{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:1;-ms-flex-negative:1;flex-shrink:1;}</style><style data-emotion-css="fxwj1n">.css-fxwj1n{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-right:16px;}</style><style data-emotion-css="3tq0b4">.css-3tq0b4.Button.Button--plain{margin-right:20px;padding:2px 4px;padding-right:4px;font-size:11px;color:#373a40;text-align:center;-webkit-align-items:flex-end;-webkit-box-align:flex-end;-ms-flex-align:flex-end;align-items:flex-end;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;white-space:nowrap;}.css-3tq0b4.Button.Button--plain:hover{background:#f8f8fa;border-radius:4px;}</style><style data-emotion-css="dvxtzn">.css-dvxtzn{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style data-emotion-css="8atqhb">.css-8atqhb{width:100%;}</style><style data-emotion-css="l1oqj5">.css-l1oqj5{height:20px;border-right:1px solid;border-color:#ebeced;margin-left:-4px;}</style><style data-emotion-css="67kea">.css-67kea.Button.Button--plain{margin-right:20px;padding:2px 4px;padding-right:1px;font-size:11px;color:#373a40;text-align:center;-webkit-align-items:flex-end;-webkit-box-align:flex-end;-ms-flex-align:flex-end;align-items:flex-end;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;white-space:nowrap;}.css-67kea.Button.Button--plain:hover{background:#f8f8fa;border-radius:4px;}</style><style data-emotion-css="hkk8jf">.css-hkk8jf{-webkit-transform:rotate(0deg);-ms-transform:rotate(0deg);transform:rotate(0deg);font-size:0;margin-bottom:2px;}</style><style data-emotion-css="k008qs">.css-k008qs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><style data-emotion-css="70qvj9">.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style data-emotion-css="1so3nbl">.css-1so3nbl{width:840px;margin:0 auto;box-sizing:border-box;padding:0 20px;background:#ffffff;margin-top:20px;position:relative;}</style><style data-emotion-css="1o83xzo">.css-1o83xzo{background:#ffffff;position:absolute;left:0;top:0;width:100%;height:100%;padding:40px;z-index:1;box-sizing:border-box;}</style><style data-emotion-css="1hl66gg">.css-1hl66gg{width:auto;background:#ffffff;padding:20px;box-sizing:border-box;}</style><style data-emotion-css="ay5346 animation-jtsrg4">.css-ay5346{border-radius:5px;height:10px;margin-bottom:16px;background-color:#f8f8fa;background-image:linear-gradient(to right,#f8f8fa 0%,#ebeced 25%,#ebeced 75%,#f8f8fa 100%);position:relative;overflow:hidden;-webkit-backface-visibility:hidden;-webkit-transform:translate3d(0,0,0);}.css-ay5346:last-child{margin-bottom:0;}.css-ay5346:last-child{width:148px;}.css-ay5346::after{content:'';position:absolute;left:0;right:0;top:0;bottom:0;width:1%;background-color:rgba(248,248,250,0.8);box-shadow:0 0 20px 20px rgba(248,248,250,0.7);-webkit-animation:animation-jtsrg4 1.5s -0.3s ease-in infinite forwards;animation:animation-jtsrg4 1.5s -0.3s ease-in infinite forwards;}@-webkit-keyframes animation-jtsrg4{0%{-webkit-transform:translateX(-8000%);-ms-transform:translateX(-8000%);transform:translateX(-8000%);}100%{-webkit-transform:translateX(10000%);-ms-transform:translateX(10000%);transform:translateX(10000%);}}@keyframes animation-jtsrg4{0%{-webkit-transform:translateX(-8000%);-ms-transform:translateX(-8000%);transform:translateX(-8000%);}100%{-webkit-transform:translateX(10000%);-ms-transform:translateX(10000%);transform:translateX(10000%);}}</style><style data-emotion-css="i6bazn">.css-i6bazn{overflow:hidden;}</style><style data-emotion-css="eehorp">.css-eehorp{min-height:calc(100vh - 190px);}</style><style data-emotion-css="j17lau">.css-j17lau .Editable_CatalogV2{left:-210px;}</style><style data-emotion-css="dojgf2">.css-dojgf2{height:1px;}</style><style data-emotion-css="1gopqwh">.css-1gopqwh{box-sizing:border-box;margin:0;min-width:0;background-color:#ebeced;height:1px;}</style><style data-emotion-css="8xc8u">.css-8xc8u{background:#ffffff;}</style><style data-emotion-css="13mrzb0">.css-13mrzb0{box-sizing:border-box;margin:0;min-width:0;background:#ffffff;}</style><style data-emotion-css="10cd47v">.css-10cd47v{line-height:61px;font-size:17px;font-weight:500;}</style><style data-emotion-css="19m36yt">.css-19m36yt{box-sizing:border-box;margin:0;min-width:0;color:#373a40;line-height:61px;font-size:17px;font-weight:500;}</style><style data-emotion-css="mfq34p">.css-mfq34p{box-sizing:border-box;margin:0;min-width:0;padding-bottom:11px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><style data-emotion-css="1olw13f">.css-1olw13f{line-height:38px;font-size:15px;font-weight:400;width:110px;padding-left:10px;}</style><style data-emotion-css="1yj4uzm">.css-1yj4uzm{box-sizing:border-box;margin:0;min-width:0;color:#373a40;margin-right:3px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;line-height:38px;font-size:15px;font-weight:400;width:110px;padding-left:10px;}</style><style data-emotion-css="1pysja1">.css-1pysja1{box-sizing:border-box;margin:0;min-width:0;-webkit-flex:1;-ms-flex:1;flex:1;}</style><style data-emotion-css="1271az4">.css-1271az4{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:150px;height:100px;border-radius:4px;border:1px dashed;border-color:#8491a5;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style data-emotion-css="18uub8x">.css-18uub8x{font-size:12px;font-weight:500;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}</style><style data-emotion-css="1i9x2dq">.css-1i9x2dq{box-sizing:border-box;margin:0;min-width:0;color:#8491a5;font-size:12px;font-weight:500;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}</style><style data-emotion-css="15ro776">.css-15ro776{margin-right:4px;}</style><style data-emotion-css="47bfxn">.css-47bfxn{font-size:13px;line-height:20px;}</style><style data-emotion-css="uas1lu">.css-uas1lu{box-sizing:border-box;margin:0;min-width:0;color:#9196a1;margin-top:8px;font-size:13px;line-height:20px;}</style><style data-emotion-css="qhzfje">.css-qhzfje{box-sizing:border-box;margin:0;min-width:0;background-color:#f8f8fa;height:20px;margin-left:-20px;margin-right:-20px;}</style><style data-emotion-css="gyp8mm">.css-gyp8mm{visibility:hidden;}</style><style data-emotion-css="688dbc">.css-688dbc{box-sizing:border-box;margin:0;min-width:0;height:52px;visibility:hidden;}</style><style data-emotion-css="blhsb3">.css-blhsb3{position:fixed;left:0;right:0;bottom:0;z-index:1;}</style><style data-emotion-css="1kutxth">.css-1kutxth{-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-top:1px solid #ebeced;background:#ffffff;-webkit-font-smoothing:subpixel-antialiased;position:fixed;left:0;right:0;bottom:0;z-index:1;}</style><style data-emotion-css="1ppjin3">.css-1ppjin3{box-sizing:border-box;margin:0;min-width:0;height:52px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-top:1px solid #ebeced;background:#ffffff;-webkit-font-smoothing:subpixel-antialiased;position:fixed;left:0;right:0;bottom:0;z-index:1;}</style><style data-emotion-css="1z0pfhy">.css-1z0pfhy{width:800px;}</style><style data-emotion-css="1xhai3h">.css-1xhai3h{box-sizing:border-box;margin:0;min-width:0;height:52px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-left:auto;margin-right:auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:800px;}</style><style data-emotion-css="9dyic7">.css-9dyic7{cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:#8491a5;}</style><style data-emotion-css="px76bk">.css-px76bk{box-sizing:border-box;margin:0;min-width:0;margin-right:4px;font-size:14px;}</style><style data-emotion-css="v8ma1f">.css-v8ma1f{box-sizing:border-box;margin:0;min-width:0;color:#8491a5;font-size:14px;margin-left:24px;}</style><style data-emotion-css="dohomd">.css-dohomd{box-sizing:border-box;margin:0;min-width:0;color:#8491a5;font-size:14px;margin-left:auto;}</style><style data-emotion-css="1itvbi0 nycwne">.css-1itvbi0{font-size:14px;color:#8491a5;}.css-nycwne{line-height:40px;white-space:nowrap;}.css-nycwne.MenuItem-Share{padding-left:0;padding-right:0;}</style><style data-emotion-css="s8vbhp">.css-s8vbhp{margin-left:20px;}</style><style data-emotion-css="ir5tdx">.css-ir5tdx{margin-left:24px;}</style><style data-emotion-css="blivob">.css-blivob{width:auto;}.css-blivob .Modal-inner{overflow:visible;}.css-blivob .Modal-content{padding-bottom:16px;}</style><style data-emotion-css="d0uhtl">.css-d0uhtl{margin-left:16px;}</style><style data-emotion-css="1cmdvua">.css-1cmdvua{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:none;}</style><style data-emotion-css="e5g8rk">.css-e5g8rk{color:inherit;width:660px;}</style><style data-emotion="css" /><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute} .MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0} .MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px} .MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important} .MathJax_Hover_Arrow:hover span {background-color: #CCC!important} </style> <style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')} #MathJax_About.MathJax_MousePost {outline: none} .MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')} .MathJax_MenuItem {padding: 2px 2em; background: transparent} .MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em} .MathJax_MenuActive .MathJax_MenuArrow {color: white} .MathJax_MenuArrow.RTL {left: .5em; right: auto} .MathJax_MenuCheck {position: absolute; left: .7em} .MathJax_MenuCheck.RTL {right: .7em; left: auto} .MathJax_MenuRadioCheck {position: absolute; left: 1em} .MathJax_MenuRadioCheck.RTL {right: 1em; left: auto} .MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic} .MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px} .MathJax_MenuDisabled {color: GrayText} .MathJax_MenuActive {background-color: Highlight; color: HighlightText} .MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8} .MathJax_ContextMenu:focus {outline: none} .MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none} #MathJax_AboutClose {top: .2em; right: .2em} .MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px} .MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0} .MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px} .MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important} .MathJax_MenuClose:hover span {background-color: #CCC!important} .MathJax_MenuClose:hover:focus {outline: none} </style> <style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important} </style> <style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none} .MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important} </style> <style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')} #MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)} #MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0} #MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)} </style> <style type="text/css">.MathJax_Preview {color: #888; display: contents} #MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap} #MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px} .MathJax_Error {color: #CC0000; font-style: italic} .MathJax_SVG .noError {white-space: normal} html[data-theme="dark"] .MathJax_SVG .noError {filter: invert(1)} .ztext-math-scrollable .MathJax_SVG {max-width: 100%; overflow-x: auto; overflow-y: hidden} .ztext-math-scrollable .MathJax_SVG svg {max-width: unset} .MathJax_SVG svg {max-width: 100%} div.MathJax_SVG_Display {display: none} .MathJax_Preview ~ .math-holder {display: none} </style> <style type="text/css">.MJXp-script {font-size: .8em} .MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right} .MJXp-bold {font-weight: bold} .MJXp-italic {font-style: italic} .MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif} .MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif} .MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif} .MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif} .MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif} .MJXp-largeop {font-size: 150%} .MJXp-largeop.MJXp-int {vertical-align: -.2em} .MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse} .MJXp-display {display: block; text-align: center; margin: 1em 0} .MJXp-math span {display: inline-block} .MJXp-box {display: block!important; text-align: center} .MJXp-box:after {content: " "} .MJXp-rule {display: block!important; margin-top: .1em} .MJXp-char {display: block!important} .MJXp-mo {margin: 0 .15em} .MJXp-mfrac {margin: 0 .125em; vertical-align: .25em} .MJXp-denom {display: inline-table!important; width: 100%} .MJXp-denom > * {display: table-row!important} .MJXp-surd {vertical-align: top} .MJXp-surd > * {display: block!important} .MJXp-script-box > * {display: table!important; height: 50%} .MJXp-script-box > * > * {display: table-cell!important; vertical-align: top} .MJXp-script-box > *:last-child > * {vertical-align: bottom} .MJXp-script-box > * > * > * {display: block!important} .MJXp-mphantom {visibility: hidden} .MJXp-munderover, .MJXp-munder {display: inline-table!important} .MJXp-over {display: inline-block!important; text-align: center} .MJXp-over > * {display: block!important} .MJXp-munderover > *, .MJXp-munder > * {display: table-row!important} .MJXp-mtable {vertical-align: .25em; margin: 0 .125em} .MJXp-mtable > * {display: inline-table!important; vertical-align: middle} .MJXp-mtr {display: table-row!important} .MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em} .MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0} .MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0} .MJXp-mlabeledtr {display: table-row!important} .MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0} .MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0} .MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%} .MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)} .MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)} .MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)} .MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)} .MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)} .MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)} .MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)} .MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)} .MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)} .MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)} .MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid} </style> <style type="text/css">.MathJax_SVG_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%} .MathJax_SVG .MJX-monospace {font-family: monospace} .MathJax_SVG .MJX-sans-serif {font-family: sans-serif} #MathJax_SVG_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none} .MathJax_SVG {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0} .MathJax_SVG * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none} .MathJax_SVG > div {display: inline-block} .mjx-svg-href {fill: blue; stroke: blue} .MathJax_SVG_Processing {visibility: hidden; position: absolute; top: 0; left: 0; width: 0; height: 0; overflow: hidden; display: block!important} .MathJax_SVG_Processed {display: none!important} .MathJax_SVG_test {font-style: normal; font-weight: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow: hidden; height: 1px} .MathJax_SVG_test.mjx-test-display {display: table!important} .MathJax_SVG_test.mjx-test-inline {display: inline!important; margin-right: -1px} .MathJax_SVG_test.mjx-test-default {display: block!important; clear: both} .MathJax_SVG_ex_box {display: inline-block!important; position: absolute; overflow: hidden; min-height: 0; max-height: none; padding: 0; border: 0; margin: 0; width: 1px; height: 60ex} .mjx-test-inline .MathJax_SVG_left_box {display: inline-block; width: 0; float: left} .mjx-test-inline .MathJax_SVG_right_box {display: inline-block; width: 0; float: right} .mjx-test-display .MathJax_SVG_right_box {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0} .MathJax_SVG .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}</style>

[![](https://zhuanlan.zhihu.com/p/649812960/edit)](<javascript:void(0)>)

[](https://www.zhihu.com/)

写文章

![点击打开Kalworth的主页](./写文章 - 知乎_files/v2-f78df504fd5fd3605eb1430c7f14c3fe_l.jpg)

​撤销

​重做

​清除格式

​标题

​加粗

​斜体

​列表

​目录

​引用

​分割线

​代码块

​注释

​图片

​视频

​链接

​公式

​表格

​附件

​文档

​历史版本

​更多

## 

前言

浅浅记录一下对KF和四元数姿态解算的学习，欢迎大家指正。对于EKF和四元数，网上的资料已经很充分了，DR\_CAN的公式推导真的很详细，这里不再赘述，该文对 wbiasw\_\{bias\}w\_\{bias\} 没有更新，理解原理之后自行加上即可。

[基于EKF的姿态解算 - 知乎 \(zhihu.com\)](https://zhuanlan.zhihu.com/p/103617763)

[四元数EKF姿态更新算法 - 知乎 \(zhihu.com\)](https://zhuanlan.zhihu.com/p/454155643)

[使用扩展卡尔曼滤波（EKF）进行AHRS九轴姿态融合\_ahrs 卡尔曼滤波\_\@奔跑的蜗牛\@的博客-CSDN博客](https://blog.csdn.net/qq_42348833/article/details/106013882)

[【卡尔曼滤波器】1\_递归算法\_Recursive Processing\_哔哩哔哩\_bilibili](https://www.bilibili.com/video/BV1ez4y1X7eR/?spm_id_from=333.1007.top_right_bar_window_history.content.click&vd_source=bc6f8794670ea20110a7c8c04ac8a8be)

## 

实现步骤

### 

1.状态量\(先验估计\)

在KF中，这里设置的状态量 xkx\_kx\_k 即是机体的四元数 \(4\)q\=\[q0q1q2q3\]T q = \\left\[ \\begin\{matrix\} q\_0\& q\_1\& q\_2 \& q\_3\\\\ \\end\{matrix\} \\right\]\^T\\tag\{4\} q = \\left\[ \\begin\{matrix\} q\_0\& q\_1\& q\_2 \& q\_3\\\\ \\end\{matrix\} \\right\]\^T\\tag\{4\}  \(5\)xk\=qx\_k = q \\tag\{5\}x\_k = q \\tag\{5\}

状态方程如下\(6\)xk\=Axk−1+Wx\_k = Ax\_\{k-1\} + W \\tag\{6\}x\_k = Ax\_\{k-1\} + W \\tag\{6\} 其中 WWW \~ N\(0,Q\)N\(0,Q\) N\(0,Q\) ,我们实际能够计算的只有前半部分

\(7\)x\^k−\=Ax\^k−1\\hat\{x\}\^-\_k = A\\hat\{x\}\_\{k-1\} \\tag\{7 \}\\hat\{x\}\^-\_k = A\\hat\{x\}\_\{k-1\} \\tag\{7 \}

状态转移矩阵A要从四元数微分方程中得来

已知四元数微分方程如下:

\(8\)q˙\=12\[0−wx−wy−wzwx0wz−wywy−wz0wxwzwy−wx0\]q\\dot\{q\} = \\frac\{1\}\{2\} \\left\[ \\begin\{matrix\} 0\& -w\_x\& -w\_y \& -w\_z\\\\ w\_x\& 0\& w\_z \& -w\_y\\\\ w\_y\& -w\_z\& 0 \& w\_x\\\\ w\_z\& w\_y\& -w\_x \& 0\\\\ \\end\{matrix\} \\right\]q\\tag\{8\}\\dot\{q\} = \\frac\{1\}\{2\} \\left\[ \\begin\{matrix\} 0\& -w\_x\& -w\_y \& -w\_z\\\\ w\_x\& 0\& w\_z \& -w\_y\\\\ w\_y\& -w\_z\& 0 \& w\_x\\\\ w\_z\& w\_y\& -w\_x \& 0\\\\ \\end\{matrix\} \\right\]q\\tag\{8\}  \(9\)Ω\=\[0−wx−wy−wzwx0wz−wywy−wz0wxwzwy−wx0\]\\Omega = \\left\[ \\begin\{matrix\} 0\& -w\_x\& -w\_y \& -w\_z\\\\ w\_x\& 0\& w\_z \& -w\_y\\\\ w\_y\& -w\_z\& 0 \& w\_x\\\\ w\_z\& w\_y\& -w\_x \& 0\\\\ \\end\{matrix\} \\right\]\\tag\{9\}\\Omega = \\left\[ \\begin\{matrix\} 0\& -w\_x\& -w\_y \& -w\_z\\\\ w\_x\& 0\& w\_z \& -w\_y\\\\ w\_y\& -w\_z\& 0 \& w\_x\\\\ w\_z\& w\_y\& -w\_x \& 0\\\\ \\end\{matrix\} \\right\]\\tag\{9\}

在数字系统中，更新四元数的方式

\(10\)q\(t+Δt\)\=\(I4+12ΩΔt\)qtq\_\{\(t+\\Delta t\)\} = \(I\_4 + \\frac\{1\}\{2\} \\Omega \\Delta t\)q\_\{t\} \\tag\{10\}q\_\{\(t+\\Delta t\)\} = \(I\_4 + \\frac\{1\}\{2\} \\Omega \\Delta t\)q\_\{t\} \\tag\{10\} 即得完整的状态方程

\(11\)x\^k−\=\(I4+12ΩΔt\)x\^k−1\\hat\{x\}\^-\_k = \(I\_4 + \\frac\{1\}\{2\} \\Omega \\Delta t\)\\hat\{x\}\_\{k-1\} \\tag\{11\}\\hat\{x\}\^-\_k = \(I\_4 + \\frac\{1\}\{2\} \\Omega \\Delta t\)\\hat\{x\}\_\{k-1\} \\tag\{11\} 这里，我们得到了状态转移矩阵A

\(12\)A\=\(I4+12ΩΔt\)A = \(I\_4 + \\frac\{1\}\{2\} \\Omega \\Delta t\) \\tag\{12\}A = \(I\_4 + \\frac\{1\}\{2\} \\Omega \\Delta t\) \\tag\{12\}

### 

2.计算先验误差协方差

\(13\)Pk−\=APk−1AT+QP\^-\_k = AP\_\{k-1\}A\^T + Q \\tag\{13\}P\^-\_k = AP\_\{k-1\}A\^T + Q \\tag\{13\} 这里套公式即可。

### 

3.观测量

观测方程如下

\(14\)Zk\=Hxk+VZ\_k = Hx\_k + V \\tag\{14\} Z\_k = Hx\_k + V \\tag\{14\}

其中 VVV \~ N\(0,R\)N\(0,R\)N\(0,R\)

这里观测量 ZkZ\_kZ\_k 就是加速度计采集到的数据。

\(15\)Zk\=\[axayaz\]T Z\_k = \\left\[ \\begin\{matrix\} a\_x\& a\_y\& a\_z\\\\ \\end\{matrix\} \\right\]\^T\\tag\{15\} Z\_k = \\left\[ \\begin\{matrix\} a\_x\& a\_y\& a\_z\\\\ \\end\{matrix\} \\right\]\^T\\tag\{15\} 在东北天坐标系下，我们定义重力加速度 GGG 向量，以及机体的加速度向量 GbG\_bG\_b

\(16\)G\=\[001\]TG = \\left\[ \\begin\{matrix\} 0\& 0\& 1\\\\ \\end\{matrix\} \\right\]\^T\\tag\{16\}G = \\left\[ \\begin\{matrix\} 0\& 0\& 1\\\\ \\end\{matrix\} \\right\]\^T\\tag\{16\}  \(17\)Gb\=\[ax′ay′az′\]TG\_b = \\left\[ \\begin\{matrix\} a\_x'\& a\_y'\& a\_z'\\\\ \\end\{matrix\} \\right\]\^T\\tag\{17\}G\_b = \\left\[ \\begin\{matrix\} a\_x'\& a\_y'\& a\_z'\\\\ \\end\{matrix\} \\right\]\^T\\tag\{17\} 根据 G\=CnbGbG = C\^b\_nG\_bG = C\^b\_nG\_b

\(18\)Gb\=Cbn\[001\]\=\[2q1q3−2q0q22q2q3+2q0q11−2q12−2q22\]G\_b = C\^n\_b \\left\[\\begin\{matrix\}0\\\\0\\\\1\\end\{matrix\}\\right\] = \\left\[\\begin\{matrix\}2q\_1q\_3-2q\_0q\_2\\\\2q\_2q\_3+2q\_0q\_1\\\\1-2q\^2\_1-2q\^2\_2\\end\{matrix\}\\right\] \\tag\{18\}G\_b = C\^n\_b \\left\[\\begin\{matrix\}0\\\\0\\\\1\\end\{matrix\}\\right\] = \\left\[\\begin\{matrix\}2q\_1q\_3-2q\_0q\_2\\\\2q\_2q\_3+2q\_0q\_1\\\\1-2q\^2\_1-2q\^2\_2\\end\{matrix\}\\right\] \\tag\{18\} 前面的文章中里 1−2q12−2q221-2q\^2\_1-2q\^2\_21-2q\^2\_1-2q\^2\_2 与 q02−q12−q22+q32q\^2\_0-q\^2\_1-q\^2\_2+q\^2\_3q\^2\_0-q\^2\_1-q\^2\_2+q\^2\_3 等价，这里使用的四元数都是单位四元数，在具体代码中一定要归一化。对上式求雅克比矩阵，我们可以得到观测矩阵 HHH

### 

\(19\)H\=\[−2q22q3−2q02q12q12q02q32q22q0−2q1−2q22q3\]H = \\left\[ \\begin\{matrix\} -2q\_2\& 2q\_3\& -2q\_0 \& 2q\_1\\\\ 2q\_1\& 2q\_0\& 2q\_3 \& 2q\_2\\\\ 2q\_0\& -2q\_1\& -2q\_2 \& 2q\_3 \\end\{matrix\} \\right\]\\tag\{19\}H = \\left\[ \\begin\{matrix\} -2q\_2\& 2q\_3\& -2q\_0 \& 2q\_1\\\\ 2q\_1\& 2q\_0\& 2q\_3 \& 2q\_2\\\\ 2q\_0\& -2q\_1\& -2q\_2 \& 2q\_3 \\end\{matrix\} \\right\]\\tag\{19\} 4.计算卡尔曼增益

\(20\)Kk\=Pk−HTHPk−HT+RK\_k = \\frac\{P\^-\_kH\^T\}\{HP\^-\_kH\^T+R\} \\tag\{20\}K\_k = \\frac\{P\^-\_kH\^T\}\{HP\^-\_kH\^T+R\} \\tag\{20\} 这里也套公式。

### 

5.后验估计

### 

\(21\)x\^k\=x\^k−1−+Kk\(Zk−Hx\^k−1−\)\\hat\{x\}\_k = \\hat\{x\}\^-\_\{k-1\}+K\_k\(Z\_k - H\\hat\{x\}\^-\_\{k-1\}\) \\tag\{21\}\\hat\{x\}\_k = \\hat\{x\}\^-\_\{k-1\}+K\_k\(Z\_k - H\\hat\{x\}\^-\_\{k-1\}\) \\tag\{21\} 6.更新误差协方差

\(22\)Pk\=\(I4−KkH\)Pk−P\_k = \(I\_4 - K\_kH\)P\^-\_k \\tag\{22\}P\_k = \(I\_4 - K\_kH\)P\^-\_k \\tag\{22\} 整个计算流程就是这些了。在得到观测矩阵 HHH 中，把原本的非线性函数\(18\)，通过求雅可比矩阵，相当于一级的泰勒展开，完成了线性化。

## 

Python源码

github地址：[kalworth/EKF.py: 基于扩展卡尔曼\(EKF\)的四元数姿态解算\(六轴\) \(github.com\)](https://github.com/kalworth/EKF.py)

使用的数据是通过串口打印保存下来的，顺序是ax,ay,az,gx,gy,gz

2024/4/29注：python代码运行的时候，注意做单位转换，xlxs里面的角速度单位是deg/s，加速度单位是g，需要转换成rad/s以及m²/s再进行运算，注意！！！\(当前python代码里没有加，懒得改了，后面有C和Matlab版本的\)

![](./写文章 - 知乎_files/v2-1b28bb1d7949cc6979d4db971e1580f8_720w.png)

加速度计与陀螺仪数据

import numpy as np import pandas as pd import matplotlib.pyplot as plt

imu\_data \= pd.read\_csv\("C:/Serial Debug 2023-8-12 174233.csv"\) imu\_data \= np.asarray\(imu\_data\) Q \=  \[0.01\]  \*  4 R \=  \[1000.0\]  \*  3 I \=  \[1.0\]  \*  4 P \=  \[10000.0\]  \*  4  class  EKF\(\):  def  \_\_init\_\_\(self, period\): self.Q\_matrix \= np.diag\(Q\) self.R\_matrix \= np.diag\(R\) self.I\_matrix \= np.diag\(I\) self.halfT \=  1/2  \* period
        self.P\_matrix \= np.diag\(P\) self.A\_matrix \= np.zeros\(\[4,4\]\) self.H\_matrix \= np.zeros\(\[3,4\]\) self.K\_matrix \= np.zeros\(\[4,3\]\) self.K\_vector \= np.zeros\(\[4,\]\) self.T\_vector \= np.zeros\(\[3,\]\) self.HX\_vector \= np.zeros\(\[3,\]\) self.Z\_vector \= np.zeros\(\[3,\]\) self.pitch \=  0.0 self.roll \=  0.0  #self.q         = np.random.randn\(4\) self.q \= np.array\(\[1.0,0.0,0.0,0.0\]\) self.pitch\_list\=  \[\] self.roll\_list \=  \[\] self.a\_pitch \=  0.0 self.a\_roll \=  0.0 self.a\_pitch\_list \=  \[\] self.a\_roll\_list \=  \[\]  def  normalizeQuternion\(self, q: np.ndarray\): norm \= np.linalg.norm\(q,2\) norm\_q \= q/norm return norm\_q def  priori\(self, gx, gy, gz\): gx\_ \= gx \* self.halfT
        gy\_ \= gy \* self.halfT
        gz\_ \= gz \* self.halfT

        self.A\_matrix \= np.array\(\[  \[1,  \-gx\_,  \-gy\_,  \-gz\_\],  \[gx\_,  1, gz\_,  \-gy\_\],  \[gy\_,  \-gz\_,  1, gx\_\],  \[gz\_, gy\_,  \-gx\_,  1\]  \]\) self.q \= np.dot\(self.A\_matrix,self.q\)  def  cal\_P\_matrix\(self\): self.P\_matrix \= np.dot\(np.dot\(self.A\_matrix,self.P\_matrix\),np.transpose\(self.A\_matrix\)\)  + self.Q\_matrix def  cal\_HX\_vector\(self, q,ax, ay, az\): self.H\_matrix \= np.array\(\[  \[\-2\*q\[2\],  2\*q\[3\],  \-2\*q\[0\],  2\*q\[1\]\],  \[2\*q\[1\],  2\*q\[0\],  2\*q\[3\],  2\*q\[2\]\],  \[2\*q\[0\],  2\*q\[1\],  2\*q\[2\],  2\*q\[3\]\]  \]\) self.HX\_vector \= np.array\(\[  2\*q\[1\]\*q\[3\]  \-  2\*q\[0\]\*q\[2\],  2\*q\[2\]\*q\[3\]  +  2\*q\[0\]\*q\[1\],  1  \-  2\*\(q\[1\]\*\*2\)  \-  2\*\(q\[2\]\*\*2\)  \]\) self.Z\_vector \= np.array\(\[ax,ay,az\]\)  def  cal\_K\_matrix\(self\): self.K\_matrix \= np.dot\( np.dot\(self.P\_matrix,np.transpose\(self.H\_matrix\)\), np.linalg.inv\( np.dot\( np.dot\( self.H\_matrix,self.P\_matrix \),np.transpose\(self.H\_matrix\)  \)  + self.R\_matrix \)  \)  def  posterior\(self\):  \# 原来是self.q\_k 改正为 self.q self.q \= self.q + np.dot\( self.K\_matrix, self.Z\_vector \- self.HX\_vector \)  def  update\_P\_matrix\(self\): self.P\_matrix \= np.dot\( self.I\_matrix \- np.dot\(self.K\_matrix,self.H\_matrix\), self.P\_matrix \)  def  Quternion2Angle\(self,q\): self.roll \=  \-np.arcsin\(2\*\(q\[0\]\*q\[2\]  \- q\[1\]\*q\[3\]\)\)  \*  57.3 self.pitch \= np.arctan2\(\(2\*\(q\[0\]\*q\[1\]  + q\[1\]\*q\[3\]\)\),  \(2\*\(q\[0\]\*q\[0\]  + q\[3\]\*q\[3\]\)  \-  1.0\)\)  \*  57.3 self.pitch\_list.append\(self.pitch\) self.roll\_list.append\(self.roll\)  def  plot\_angle\(self, angle\_list, color, angle\_name\): x \= np.arange\(0,  len\(angle\_list\),  1\) y \= np.array\(angle\_list\) plt.plot\(x,y,color\=color,linewidth\=1,label\=angle\_name\)  def  cal\_a\_angle\(self, ax, ay, az\): self.a\_pitch \= np.arctan2\(ay,az\)  \*  57.3 self.a\_roll \= np.arctan\(ax/np.sqrt\(ay\*ay+az\*az\)\)  \*  57.3 self.a\_pitch\_list.append\(self.a\_pitch\) self.a\_roll\_list.append\(self.a\_roll\)  def  EKF\_update\(self,imu\_sorce\_data\):  for i in  range\(2\):  for data in imu\_sorce\_data: self.q \= self.normalizeQuternion\(self.q\) self.priori\(data\[3\], data\[4\], data\[5\]\) self.q \= self.normalizeQuternion\(self.q\) self.cal\_P\_matrix\(\) self.cal\_HX\_vector\(self.q, data\[0\], data\[1\], data\[2\]\) self.cal\_K\_matrix\(\) self.posterior\(\) self.update\_P\_matrix\(\) self.Quternion2Angle\(self.q\) self.cal\_a\_angle\(data\[0\],data\[1\],data\[2\]\) plt.figure\(\)  \# 画布尺寸默认 self.plot\_angle\(self.pitch\_list,'red','pitch'\) self.plot\_angle\(self.a\_pitch\_list,  'blue',  'roll'\) plt.legend\(\['EKF\_pitch','acc\_pitch'\], loc\='best'\) plt.figure\(\)  \# 画布尺寸默认 self.plot\_angle\(self.roll\_list,'green','pitch'\) self.plot\_angle\(self.a\_roll\_list,  'black',  'roll'\) plt.legend\(\['EKF\_roll','acc\_roll'\], loc\='best'\) plt.show\(\)  if \_\_name\_\_ \==  "\_\_main\_\_": EKF\_model \= EKF\(period\=0.0001\) EKF\_model.EKF\_update\(imu\_data\)

对滤波效果影响较大的因素：机体四元数q的初值以及采样周期。卡尔曼增益会收敛，QR阵参数合理即可。

![](./写文章 - 知乎_files/v2-544e8663e7e0f16b390fca439d3a52aa_720w.jpeg)

roll角经过EKF与只用加速度计解算作比较

![](./写文章 - 知乎_files/v2-edd0b940aa7349e8e6f292e015d1c1b6_720w.png)

局部放大

比较明显的是经过EKF之后，波形更加平滑，利于进一步的使用。

以下是在MCU中运行的程序，如果有错的地方欢迎指出来。

typedef  struct  \{  float period;  // 姿态更新周期  float half\_T;  // 姿态更新周期的1/2      单位：s  float I\_matrix\[16\];  // 单位矩阵              4 \* 4  float Q\_matrix\[16\];  // 过程噪声协方差矩阵      4 \* 4  float R\_matrix\[9\];  // 观测噪声协方差矩阵      3 \* 3  float A\[16\];  // 状态转移矩阵           4 \* 4  float H\[12\];  // 观测矩阵              3 \* 4  float p\_hat\[16\];  // 误差协方差矩阵         4 \* 4  float K\[12\];  // 卡尔曼增益矩阵         4 \* 3  float Kq\[4\];  // 四元数卡尔曼增益        4 \* 1  float T\[3\];  // 残差向量               3 \* 1  float q\[4\];  // 机体四元数             4 \* 1  float q\_k\[4\];  // 优化后的四元数          4 \* 1  float vector\_hat\[3\];  // 观测重力加速度          3 \* 1  void  \(\*filter\)\(float,float,float,  // EKF更新姿态函数指针  float,float,float\);  \}EKF\_StructTypeDef;  

关于EKF的结构体

static EKF\_StructTypeDef      imu\_ekf;  // EKF

然后是初始化， Q，RQ，R 噪声矩阵与我们的状态量和观测量是对应的。Q\_\{4×4\}Q\_\{4×4\} 协方差矩阵对应预测向量的协方差， R\_\{3×3\}R\_\{3×3\} 协方差矩阵对应观测向量的协方差。 QQ 的值与预测值的权重成反比，即Q矩阵中协方差越小，越相信预测值\(对应相信角速度\)，R的值与观测值的权重成反比，即R矩阵中协方差越小，越相信观测值\(对应相信加速度\)。

/\*\*
  \* \@brief  EKF初始化
  \* \@param  None
  \* \@note   None
  \* \@retval None
  \*/  static  void  EKF\_init\(void\)  \{ imu\_ekf.period \=  0.001;  // 姿态解算周期 1ms imu\_ekf.half\_T \= imu\_ekf.period /  2.0f; imu\_ekf.I\_matrix\[0\]  \=  1; imu\_ekf.I\_matrix\[1\]  \=  0; imu\_ekf.I\_matrix\[2\]  \=  0; imu\_ekf.I\_matrix\[3\]  \=  0; imu\_ekf.I\_matrix\[4\]  \=  0; imu\_ekf.I\_matrix\[5\]  \=  1; imu\_ekf.I\_matrix\[6\]  \=  0; imu\_ekf.I\_matrix\[7\]  \=  0; imu\_ekf.I\_matrix\[8\]  \=  0; imu\_ekf.I\_matrix\[9\]  \=  0; imu\_ekf.I\_matrix\[10\]  \=  1; imu\_ekf.I\_matrix\[11\]  \=  0; imu\_ekf.I\_matrix\[12\]  \=  0;imu\_ekf.I\_matrix\[13\]  \=  0; imu\_ekf.I\_matrix\[14\]  \=  0; imu\_ekf.I\_matrix\[15\]  \=  1;  float Q\_Val \=  0.01; imu\_ekf.Q\_matrix\[0\]  \= Q\_Val; imu\_ekf.Q\_matrix\[1\]  \=  0; imu\_ekf.Q\_matrix\[2\]  \=  0; imu\_ekf.Q\_matrix\[3\]  \=  0; imu\_ekf.Q\_matrix\[4\]  \=  0; imu\_ekf.Q\_matrix\[5\]  \= Q\_Val; imu\_ekf.Q\_matrix\[6\]  \=  0; imu\_ekf.Q\_matrix\[7\]  \=  0; imu\_ekf.Q\_matrix\[8\]  \=  0; imu\_ekf.Q\_matrix\[9\]  \=  0; imu\_ekf.Q\_matrix\[10\]  \= Q\_Val;imu\_ekf.Q\_matrix\[11\]  \=  0; imu\_ekf.Q\_matrix\[12\]  \=  0; imu\_ekf.Q\_matrix\[13\]  \=  0; imu\_ekf.Q\_matrix\[14\]  \=  0; imu\_ekf.Q\_matrix\[15\]  \= Q\_Val;  float R\_Val \=  1000000; imu\_ekf.R\_matrix\[0\]  \= R\_Val; imu\_ekf.R\_matrix\[1\]  \=  0; imu\_ekf.R\_matrix\[2\]  \=  0; imu\_ekf.R\_matrix\[3\]  \=  0; imu\_ekf.R\_matrix\[4\]  \= R\_Val; imu\_ekf.R\_matrix\[5\]  \=  0; imu\_ekf.R\_matrix\[6\]  \=  0; imu\_ekf.R\_matrix\[7\]  \=  0; imu\_ekf.R\_matrix\[8\]  \= R\_Val;  float P\_Val \=  100000; imu\_ekf.p\_hat\[0\]  \= P\_Val;imu\_ekf.p\_hat\[1\]  \=  0; imu\_ekf.p\_hat\[2\]  \=  0; imu\_ekf.p\_hat\[3\]  \=  0; imu\_ekf.p\_hat\[4\]  \=  0; imu\_ekf.p\_hat\[5\]  \= P\_Val;imu\_ekf.p\_hat\[6\]  \=  0; imu\_ekf.p\_hat\[7\]  \=  0; imu\_ekf.p\_hat\[8\]  \=  0; imu\_ekf.p\_hat\[9\]  \=  0; imu\_ekf.p\_hat\[10\]  \= P\_Val;imu\_ekf.p\_hat\[11\]  \=  0; imu\_ekf.p\_hat\[12\]  \=  0; imu\_ekf.p\_hat\[13\]  \=  0; imu\_ekf.p\_hat\[14\]  \=  0; imu\_ekf.p\_hat\[15\]  \= P\_Val; imu\_ekf.q\[0\]  \=  1; imu\_ekf.q\[1\]  \=  0; imu\_ekf.q\[2\]  \=  0; imu\_ekf.q\[3\]  \=  0; imu\_ekf.q\_k\[0\]  \=  1; imu\_ekf.q\_k\[1\]  \=  0; imu\_ekf.q\_k\[2\]  \=  0; imu\_ekf.q\_k\[3\]  \=  0; imu\_ekf.filter \= ekf\_update;  \}

接下来就是四元数的更新了，实现上文提到的过的完整的EKF的计算流程，关于矩阵运算的函数，我找的GPT生成的，自己用dev-c还验证了一下，计算卡尔曼增益的时候需要求矩阵的逆阵，我只用了一个只能求3×3的逆矩阵的函数。\(事实是，没找到合适的矩阵库，参考的几位大佬用的是一维的数组，设定一个形状的矩阵\)。想要获取欧拉角，做一步转换即可。

/\*\*
  \* \@brief  扩展卡尔曼 优化四元数
  \* \@param  gx      x轴角速度
  \* \@param  gy      y轴角速度
  \* \@param  gz      z轴角速度
  \* \@param  ax      x轴加速度
  \* \@param  ay      y轴加速度
  \* \@param  az      z轴加速度
  \* \@note   None
  \* \@retval None
  \*/  static  void  ekf\_update\(float gx,  float gy,  float gz,  float ax,  float ay,  float az\)  \{  #define  DIV\_180\_PI  \(float\)\(57.295779513f\)  #define  GRAVITY  \(float\)\(9.8f\)  // 单位换算, deg/s转换到rad/s, g换算到m²/2 gx /= DIV\_180\_PI; gy /= DIV\_180\_PI; gz /= DIV\_180\_PI; ax \*= GRAVITY; ay \*= GRAVITY; az \*= GRAVITY;  normalize\_quternion\(imu\_ekf.q\);  /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* 状态方程 \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/  /\* 1/2姿态更新周期赋值 \*/  float half\_T \= imu\_ekf.half\_T;  /\* 四元数微分方程离散化 \*/ imu\_ekf.q\[0\]  +=  \(\-imu\_ekf.q\[1\]  \* gx \- imu\_ekf.q\[2\]  \* gy \- imu\_ekf.q\[3\]  \* gz\)  \*  \(float\)half\_T; imu\_ekf.q\[1\]  +=  \( imu\_ekf.q\[0\]  \* gx + imu\_ekf.q\[2\]  \* gz \- imu\_ekf.q\[3\]  \* gy\)  \*  \(float\)half\_T; imu\_ekf.q\[2\]  +=  \( imu\_ekf.q\[0\]  \* gy \- imu\_ekf.q\[1\]  \* gz + imu\_ekf.q\[3\]  \* gx\)  \*  \(float\)half\_T; imu\_ekf.q\[3\]  +=  \( imu\_ekf.q\[0\]  \* gz + imu\_ekf.q\[1\]  \* gy \- imu\_ekf.q\[2\]  \* gx\)  \*  \(float\)half\_T;  /\*   四元数 归一化    \*/  normalize\_quternion\(imu\_ekf.q\);  /\*  状态转移矩阵赋值   \*/ imu\_ekf.A\[0\]  \=  1; imu\_ekf.A\[1\]  \=  \-gx \* half\_T; imu\_ekf.A\[2\]  \=  \-gy \* half\_T; imu\_ekf.A\[3\]  \=  \-gz \* half\_T; imu\_ekf.A\[4\]  \= gx \* half\_T; imu\_ekf.A\[5\]  \=  1; imu\_ekf.A\[6\]  \= gz \* half\_T; imu\_ekf.A\[7\]  \=  \-gy \* half\_T; imu\_ekf.A\[8\]  \= gy \* half\_T; imu\_ekf.A\[9\]  \=  \-gz \* half\_T; imu\_ekf.A\[10\]\=  1; imu\_ekf.A\[11\]\= gx \* half\_T; imu\_ekf.A\[12\]\= gz \* half\_T; imu\_ekf.A\[13\]\= gy \* half\_T; imu\_ekf.A\[14\]\=  \-gx \* half\_T; imu\_ekf.A\[15\]\=  1;  /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* 状态方程 \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/  /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* 估算协方差矩阵 \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/  float temp\_matrix1\[16\];  float temp\_matrix2\[16\];  float temp\_matrix3\[16\];  matrix\_multiply\(imu\_ekf.A,imu\_ekf.p\_hat,temp\_matrix1,4,4,4\);  matrix\_transpose\(imu\_ekf.A,temp\_matrix2,4,4\);  matrix\_multiply\(temp\_matrix1,temp\_matrix2,temp\_matrix3,4,4,4\);  matrix\_add\(temp\_matrix3,imu\_ekf.Q\_matrix,imu\_ekf.p\_hat,4,4\);  /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* 估算协方差矩阵 \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/  /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* 观测方程 \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/  /\*   观测向量计算  \*/ imu\_ekf.vector\_hat\[0\]  \=  2  \*  \(imu\_ekf.q\[1\]  \* imu\_ekf.q\[3\]  \- imu\_ekf.q\[0\]  \* imu\_ekf.q\[2\]\); imu\_ekf.vector\_hat\[1\]  \=  2  \*  \(imu\_ekf.q\[2\]  \* imu\_ekf.q\[3\]  + imu\_ekf.q\[0\]  \* imu\_ekf.q\[1\]\); imu\_ekf.vector\_hat\[2\]  \= imu\_ekf.q\[0\]  \* imu\_ekf.q\[0\]  \- imu\_ekf.q\[1\]  \* imu\_ekf.q\[1\]  \- imu\_ekf.q\[2\]  \* imu\_ekf.q\[2\]  + imu\_ekf.q\[3\]  \* imu\_ekf.q\[3\];  /\*    观测矩阵赋值    \*/ imu\_ekf.H\[0\]  \=  \-2  \* imu\_ekf.q\[2\]; imu\_ekf.H\[1\]  \=  2  \* imu\_ekf.q\[3\]; imu\_ekf.H\[2\]  \=  \-2  \* imu\_ekf.q\[0\]; imu\_ekf.H\[3\]  \=  2  \* imu\_ekf.q\[1\]; imu\_ekf.H\[4\]  \=  2  \* imu\_ekf.q\[1\]; imu\_ekf.H\[5\]  \=  2  \* imu\_ekf.q\[0\]; imu\_ekf.H\[6\]  \=  2  \* imu\_ekf.q\[3\]; imu\_ekf.H\[7\]  \=  2  \* imu\_ekf.q\[2\]; imu\_ekf.H\[8\]  \=  2  \* imu\_ekf.q\[0\]; imu\_ekf.H\[9\]  \=  \-2  \* imu\_ekf.q\[1\]; imu\_ekf.H\[10\]  \=  \-2  \* imu\_ekf.q\[2\]; imu\_ekf.H\[11\]  \=  2  \* imu\_ekf.q\[3\];  /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* 观测方程 \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/  /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* 计算卡尔曼增益 \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/  float temp\_matrix4\[12\];  float temp\_matrix5\[12\];  float temp\_matrix6\[9\];  float temp\_matrix7\[9\];  float temp\_matrix8\[9\];  float HT\[12\];  matrix\_transpose\(imu\_ekf.H,HT,3,4\);  matrix\_multiply\(imu\_ekf.p\_hat,HT,temp\_matrix4,4,4,3\);  matrix\_multiply\(imu\_ekf.H,imu\_ekf.p\_hat,temp\_matrix5,3,4,4\);  matrix\_multiply\(temp\_matrix5,HT,temp\_matrix6,3,4,3\);  matrix\_add\(temp\_matrix6,imu\_ekf.R\_matrix,temp\_matrix7,3,3\);  calculateInverse\(temp\_matrix7,temp\_matrix8\);  matrix\_multiply\(temp\_matrix4,temp\_matrix8,imu\_ekf.K,4,3,3\);  /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* 计算卡尔曼增益 \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/  /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* 计算残差 \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/  /\*   归一化加速度计    \*/  float norm \=  sqrtf\(ax \* ax + ay \* ay + az\* az\); ax /= norm; ay /= norm; az /= norm;  /\*    计算残差向量    \*/ imu\_ekf.T\[0\]  \= ax \- imu\_ekf.vector\_hat\[0\]; imu\_ekf.T\[1\]  \= ay \- imu\_ekf.vector\_hat\[1\]; imu\_ekf.T\[2\]  \= az \- imu\_ekf.vector\_hat\[2\];  /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* 计算残差 \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/  /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* 后验估计四元数 \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/  matrix\_multiply\(imu\_ekf.K,imu\_ekf.T,imu\_ekf.Kq,4,3,1\);  /\*    后验四元数      \*/ imu\_ekf.q\_k\[0\]  \= imu\_ekf.q\[0\]  + imu\_ekf.Kq\[0\]; imu\_ekf.q\_k\[1\]  \= imu\_ekf.q\[1\]  + imu\_ekf.Kq\[1\]; imu\_ekf.q\_k\[2\]  \= imu\_ekf.q\[2\]  + imu\_ekf.Kq\[2\]; imu\_ekf.q\_k\[3\]  \= imu\_ekf.q\[3\]  + imu\_ekf.Kq\[3\];  /\*    归一化四元数     \*/  normalize\_quternion\(imu\_ekf.q\_k\);  /\*    更新 四元数     \*/ imu\_ekf.q\[0\]  \= imu\_ekf.q\_k\[0\]; imu\_ekf.q\[1\]  \= imu\_ekf.q\_k\[1\]; imu\_ekf.q\[2\]  \= imu\_ekf.q\_k\[2\]; imu\_ekf.q\[3\]  \= imu\_ekf.q\_k\[3\];  /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* 后验估计四元数 \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/  /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* 更新协方差矩阵 \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/  float temp\_matrix9\[16\];  float temp\_matrix10\[16\];  float temp\_matrix11\[16\];  matrix\_multiply\(imu\_ekf.K,imu\_ekf.H,temp\_matrix9,4,3,4\);  matrix\_subtract\(imu\_ekf.I\_matrix,temp\_matrix9,temp\_matrix10,4,4\);  matrix\_multiply\(temp\_matrix10,imu\_ekf.p\_hat,temp\_matrix11,4,4,4\);  matrix\_copy\(temp\_matrix11,imu\_ekf.p\_hat,4,4\);  /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* 更新协方差矩阵 \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/  \}

重要的事情说三遍，一定要注意采样周期！一定要注意采样周期！一定要注意采样周期！

  

最后，结尾留一个问题，这里的q的初始值为什么是 \\left\[1 \\space0\\space 0\\space0\\right\]\^T\\left\[1 \\space0\\space 0\\space0\\right\]\^T ,怪中之怪。\(见评论区\)

## 

优化效果

这里和纯加速度做对比。

![](./写文章 - 知乎_files/v2-f83939b358c62508ee2bf7d6f3806498_720w.png)

加速度计解算与ekf解算

![](./写文章 - 知乎_files/v2-1b0bd9be56cbb1f402fbd711e87597ac_720w.png)

局部放大

### 

Vofa+上位机查看mcu滤波效果

![](./写文章 - 知乎_files/v2-912c5e82d17c60f88169d18f30ec375a_720w.png)

红色曲线为EKF优化之后的俯仰角，蓝色曲线为纯加速度计解算

这幅图是大角度小摆动速度和小角度大摆动速度测得的解算曲线，很明显的可以看到，EKF对运动加速度带来的误差有不错的抑制效果。

### 

姿态解算修正

今天在做matlab仿真时，发现姿态更新的单位有点问题，上面的C代码部分已经同步更新。

![](./写文章 - 知乎_files/v2-4638da6bf8d087c2362c9aed21634603_720w.jpeg)

Roll角

![](./写文章 - 知乎_files/v2-837fec16a3aec51b5678e675ce002563_720w.jpeg)

Pitch角

在修改了单位之后，可以对比之前的图片，相位滞后几乎没有了，再用上玺佬的PQR三个矩阵的初始值，效果可以在平衡车上正常使用了。

最近比较忙，矩阵运算部分过一阵子会开源出来，不限制MCU的平台，纯软件的矩阵算法，因为这个EKF只用到了特殊尺寸的矩阵运算，所以库里有针对性的矩阵运算。

### 

MATLAB仿真程序以及串口输出文件

\% 加载陀螺仪数据
\% 顺序ax,ay,az,gx,gy,gz
\% acc的单位是g
\% gyro的单位是deg/s
data = load\('D:/Serial Debug 2023-12-25 215322.csv'\);

\% 获取数据个数 一组数据 ax ay az gx gy gz  
numRows = size\(data, 1\); 

\% 迭代次数
epoch = 2;

\% 欧拉角
global eul\_deg;
eul\_deg = zeros\(numRows\*epoch,3\);

\% 加速度计欧拉角
global eul\_acc\_deg;
eul\_acc\_deg = zeros\(numRows\*epoch,2\);

\% 更新周期
global period\_T;
period\_T = 0.001;

\% 更新周期的一半
global Half\_T;
Half\_T = period\_T / 2;

 \% 机体四元数
global q; 
q = transpose\(\[1 0 0 0\]\);

\% 观测向量
global Z;

\% 状态转移矩阵
global A;

\% 观测矩阵
global H;

\% 误差协方差矩阵
global P;
P\_value = 100000;
P\_diag = \[P\_value P\_value P\_value P\_value\];
P = diag\(P\_diag\);

\% 过程噪声协方差矩阵
global Q;
Q\_value = 0.01;
Q\_diag = \[Q\_value Q\_value Q\_value Q\_value\];
Q = diag\(Q\_diag\);

\% 测量噪声协方差矩阵
global R;
R\_value = 1000000;
R\_diag = \[R\_value R\_value R\_value\];
R = diag\(R\_diag\);

\% 卡尔曼增益
global K;

global deg\_num;
deg\_num = 1;
for j = 1:epoch
    \% 使用for循环遍历每一行  
    for i = 1:numRows  
        \% 访问当前行的所有元素  
        row = data\(i, :\); \% 使用冒号来选择所有列  

        ax = row\(1\) \* 9.8;
        ay = row\(2\) \* 9.8;
        az = row\(3\) \* 9.8;
        gx = row\(4\) / 57.3;
        gy = row\(5\)/ 57.3;
        gz = row\(6\)/ 57.3;

        \% 先验估计
        A =  update\_A\(gx,gy,gz\);
        q = A \* q; 

        \% 计算先验误差协方差
        AT = transpose\(A\);
        P = A\*P\*AT + Q;

        \% 更新观测向量
        Z = transpose\(\[ax,ay,az\]\);

        \% 更新观测矩阵
        H = update\_H\(q\);

        \% 计算卡尔曼增益
        HT = transpose\(H\);
        K = \(P\*HT\) / \(H\*P\*HT+R\);

        \% 后验估计
        q = q + K \* \(Z - H\*q\);

        \% 更新误差协方差
        P = \(eye\(4\) - K \* H\) \* P;

        \% 欧拉角解算
        qt = transpose\(q\);
        eul = quat2eul\(qt\);  
        eul\_deg\(deg\_num,:\) = rad2deg\(eul\);

        eul\_acc\_deg\(deg\_num,1\) = rad2deg\(atan2\(ay,az\)\);
        eul\_acc\_deg\(deg\_num,2\) = -rad2deg\(atan\(ax/sqrt\(ay\*ay+az\*az\)\)\);
        deg\_num = deg\_num + 1;
    end
end

line\_width = 2;
figure; \% 激活第三个子图  
plot\(1:numRows\*epoch, eul\_deg\(:,3\), 'b-','LineWidth', line\_width\); \% 绘制滚转角（roll）  
hold on; \% 保持当前图形，以便添加更多曲线  
plot\(1:numRows\*epoch, eul\_acc\_deg\(:,1\), 'r-','LineWidth', line\_width\); \% 绘制滚转角（roll）  
legend\('ekf', 'acc'\);  
title\('Pitch Angle \(degrees\)'\);  
xlabel\('Time'\);  
ylabel\('Angle'\); 

figure; \% 激活第三个子图  
plot\(1:numRows\*epoch, eul\_deg\(:,2\), 'b-','LineWidth', line\_width\); \% 绘制滚转角（roll）  
hold on; \% 保持当前图形，以便添加更多曲线  
plot\(1:numRows\*epoch, eul\_acc\_deg\(:,2\), 'r-','LineWidth', line\_width\); \% 绘制滚转角（roll）  
legend\('ekf', 'acc'\); 
title\('Roll Angle \(degrees\)'\);  
xlabel\('Time'\);  
ylabel\('Angle'\); 


\% 状态转移矩阵更新
function A\_Update = update\_A\(gx,gy,gz\)
    global Half\_T; 
    gx\_ = gx \* Half\_T;
    gy\_ = gy \* Half\_T;
    gz\_ = gz \* Half\_T;
    A\_Update = \[  1  -gx\_ -gy\_  -gz\_;
                 gx\_  1    gz\_  -gy\_;
                 gy\_ -gz\_   1    gx\_; 
                 gz\_  gy\_ -gx\_    1 ;\];
end

\% 测量矩阵更新
function H\_Update = update\_H\(q\)
    q0 = q\(1\);
    q1 = q\(2\);
    q2 = q\(3\);
    q3 = q\(4\);
    
    H\_Update = \[-2\*q2  2\*q3 -2\*q0 2\*q1;
                 2\*q1  2\*q0  2\*q3 2\*q2;
                 2\*q0 -2\*q1 -2\*q2 2\*q3\];
end

matlab仿真脚本以及xlxs串口数据地址[kalworth/EKF\_Angle \(github.com\)](https://github.com/kalworth/EKF_Angle)

发布设置

添加封面

添加文章封面

图片上传格式支持 JPEG、JPG、PNG

创作声明​

无声明

\*

文章话题​

姿态解算

姿态

python爬虫

内容来源

根据自媒体投稿规范，发布新闻类的内容需要明确标注信息来源，请确认当前内容是否已正确添加

​添加来源

发布设置

字数：18080

Markdown 语法识别中

​

草稿已保存

预览

更新

\{"fetchRoot":\{"www":"https:\\u002F\\u002Fwww.zhihu.com","api":"https:\\u002F\\u002Fapi.zhihu.com","lens":"https:\\u002F\\u002Flens.zhihu.com","zhuanlan":"https:\\u002F\\u002Fzhuanlan.zhihu.com\\u002Fapi\\u002F","walletpay":"https:\\u002F\\u002Fwalletpay.zhihu.com","captcha":"https:\\u002F\\u002Fcaptcha.zhihu.com","vzuu":"https:\\u002F\\u002Fv.vzuu.com","openapi":"https:\\u002F\\u002Fopenapi.zhihu.com","svip":"https:\\u002F\\u002Fsvip.zhihu.com"\},"host":"zhihu.com","protocol":"https:","wwwHost":"www.zhihu.com","videoHost":"video.zhihu.com","zhuanlanHost":"zhuanlan.zhihu.com","allowSignUp":true,"refreshValidityPeriod":"30","release":"1310-3d84e9db","currentEntry":"column","isMobileEntry":false,"apollo":\{"env":"prod","globalSilence":"","ncgModeSign":"3f8e56febda4fb3bbea72e379d76de1e","topstory\_rec\_adp":"1","topstory\_hot\_adp":"1","editor\_adapt\_native":"0","editor\_auto\_rotate":"0","enable\_request\_filter":"1","content\_publish\_pin":"0","content\_publish\_answer":"1","content\_publish\_question":"1","content\_publish\_article":"1","content\_publish\_zvideo":"1","balanceModalSign":"ChYHAcB5ihJECkAFnhDAYmdhsTWVJoNc","reportBackendPublishError":"1","test\_canary":"member|0-100,1-0","use\_new\_player":"member|0-100,1-0","player\_vendor":"member|0-100,1-0,2-0","use\_hevc":"member|0-0,1-100","upload\_use\_signature":"member|0-0,1-100","use\_backdrop\_blur":"member|0-0,1-100","article\_title\_imagex":"member|0-0,1-100","play\_station":"member|0-0,1-100","use\_cached\_supported\_countries":"device|1-100,0-0","contentItem\_cover\_imagex":"member|0-0,1-100","use\_qrcode\_login\_v2":"device|1-100,0-0"\}\}\{"initialState":\{"common":\{"ask":\{\},"cities":\{"cityData":\[\]\}\},"loading":\{"global":\{"count":0\},"local":\{"env\\u002FgetIpinfo\\u002F":false\}\},"entities":\{"users":\{"cb2b035a303f34c9cbff59af08a36450":\{"uid":1449005319473410000,"userType":"people","id":"cb2b035a303f34c9cbff59af08a36450"\}\},"questions":\{\},"answers":\{\},"articles":\{\},"columns":\{\},"topics":\{\},"roundtables":\{\},"favlists":\{\},"comments":\{\},"notifications":\{\},"ebooks":\{\},"activities":\{\},"feeds":\{\},"pins":\{\},"promotions":\{\},"drafts":\{\},"chats":\{\},"posts":\{\},"zvideos":\{\},"zvideoContributions":\{\},"briefs":\{\},"eduCourses":\{\}\},"currentUser":"cb2b035a303f34c9cbff59af08a36450","account":\{"unlockTicketStatus":false,"unlockTicket":null,"challenge":\[\],"errorStatus":false,"message":"","isFetching":false,"accountInfo":\{\},"urlToken":\{"loading":false\},"cardUserInfo":\{"vipInfo":\{\}\},"handleWidget":\{\},"widgetList":\[\],"userWidgetId":""\},"settings":\{"socialBind":null,"inboxMsg":null,"notification":\{\},"email":\{\},"privacyFlag":null,"blockedUsers":\{"isFetching":false,"paging":\{"pageNo":1,"pageSize":6\},"data":\[\]\},"blockedFollowees":\{"isFetching":false,"paging":\{"pageNo":1,"pageSize":6\},"data":\[\]\},"ignoredTopics":\{"isFetching":false,"paging":\{"pageNo":1,"pageSize":6\},"data":\[\]\},"restrictedTopics":null,"laboratory":\{\}\},"notification":\{\},"people":\{"profileStatus":\{\},"activitiesByUser":\{\},"answersByUser":\{\},"answersSortByVotesByUser":\{\},"answersIncludedByUser":\{\},"votedAnswersByUser":\{\},"thankedAnswersByUser":\{\},"voteAnswersByUser":\{\},"thankAnswersByUser":\{\},"topicAnswersByUser":\{\},"zvideosByUser":\{\},"articlesByUser":\{\},"articlesSortByVotesByUser":\{\},"articlesIncludedByUser":\{\},"pinsByUser":\{\},"questionsByUser":\{\},"commercialQuestionsByUser":\{\},"favlistsByUser":\{\},"followingByUser":\{\},"followersByUser":\{\},"mutualsByUser":\{\},"followingColumnsByUser":\{\},"followingQuestionsByUser":\{\},"followingFavlistsByUser":\{\},"followingTopicsByUser":\{\},"publicationsByUser":\{\},"columnsByUser":\{\},"allFavlistsByUser":\{\},"brands":null,"creationsByUser":\{\},"creationsSortByVotesByUser":\{\},"creationsFeed":\{\},"infinity":\{\},"batchUsers":\{\},"profileInfinity":null\},"env":\{"ab":\{"config":\{\},"triggers":\{\}\},"abV2":\{"config":\{"paramMap":\{"ws\_publish\_answer":\{"value":"1","abId":"rl-pc\_pub\_answer\_2-1"\},"ws\_platform\_new":\{"value":"1","abId":"author\_platform-1"\},"ws\_video\_publish":\{"value":"1","abId":"rl-video\_contentpub-1"\},"ws\_publish\_post":\{"value":"1","abId":"rl-publish\_article-1"\},"pc\_mou\_cre\_remove":\{"value":"1","abId":"rl-mou\_create\_remove-1"\},"ws\_publish\_ask":\{"value":"1","abId":"rl-pc\_publish\_ask-1"\}\},"abMap":\{"rl-pc\_pub\_answer\_2-1":\{"abId":"rl-pc\_pub\_answer\_2-1","layerId":"rl-pc\_pub\_answer\_2","diversionType":2\},"author\_platform-1":\{"abId":"author\_platform-1","layerId":"author\_platform\_layer","diversionType":2\},"rl-video\_contentpub-1":\{"abId":"rl-video\_contentpub-1","layerId":"rl-video\_contentpub","diversionType":2\},"rl-publish\_article-1":\{"abId":"rl-publish\_article-1","layerId":"rl-publish\_article","diversionType":2\},"rl-mou\_create\_remove-1":\{"abId":"rl-mou\_create\_remove-1","layerId":"rl-mou\_create\_remove","diversionType":2\},"rl-pc\_publish\_ask-1":\{"abId":"rl-pc\_publish\_ask-1","layerId":"rl-pc\_publish\_ask","diversionType":2\}\}\},"triggers":\{\}\},"userAgent":\{"Edge":false,"IE":false,"Wechat":false,"Weibo":false,"QQ":false,"MQQBrowser":false,"Qzone":false,"Mobile":false,"Android":false,"iOS":false,"isAppleDevice":false,"Zhihu":false,"ZhihuHybrid":false,"isBot":false,"Tablet":false,"UC":false,"Quark":false,"Sogou":false,"Qihoo":false,"Baidu":false,"BaiduApp":false,"Safari":false,"GoogleBot":false,"AndroidDaily":false,"iOSDaily":false,"WxMiniProgram":false,"BaiduMiniProgram":false,"QQMiniProgram":false,"JDMiniProgram":false,"isWebView":false,"isMiniProgram":false,"origin":"Mozilla\\u002F5.0 \(Windows NT 10.0; Win64; x64\) AppleWebKit\\u002F537.36 \(KHTML, like Gecko\) Chrome\\u002F124.0.0.0 Safari\\u002F537.36 Edg\\u002F124.0.0.0"\},"appViewConfig":\{\},"ctx":\{"path":"\\u002Fp\\u002F649812960\\u002Fedit","query":\{\},"href":"http:\\u002F\\u002Fzhuanlan.zhihu.com\\u002Fp\\u002F649812960\\u002Fedit","host":"zhuanlan.zhihu.com"\},"trafficSource":"production","edition":\{"beijing":false,"baidu":false,"sogou":false,"baiduBeijing":false,"sogouBeijing":false,"sogouInput":false,"oppoSearch":false,"baiduSearch":false,"googleSearch":false,"shenma":false,"miniProgram":false,"xiaomi":false,"huaweiSearch":false\},"theme":"light","appHeaderTheme":\{"current":"normal","disable":true,"normal":\{"bgColor":"GBK99A"\},"custom":\{"bgColor":"GBK99A"\}\},"enableShortcut":true,"referer":"https:\\u002F\\u002Fzhuanlan.zhihu.com\\u002Fp\\u002F649812960\?","xUDId":"AHDTGsvX3RePToJRLxTAEFX-q-EW-p7yTkE=","mode":"ssr","conf":\{\},"xTrafficFreeOrigin":"","ipInfo":\{"cityName":"哈尔滨","countryName":"中国","regionName":"黑龙江","countryCode":"CN"\},"logged":true,"vars":\{"passThroughHeaders":\{\}\}\},"me":\{"columnContributions":\[\]\},"label":\{\},"ecommerce":\{\},"comments":\{"pagination":\{\},"collapsed":\{\},"reverse":\{\},"reviewing":\{\},"conversation":\{\},"parent":\{\}\},"commentsV2":\{"stickers":\[\],"commentWithPicPermission":\{\},"notificationsComments":\{\},"pagination":\{\},"collapsed":\{\},"reverse":\{\},"reviewing":\{\},"conversation":\{\},"conversationMore":\{\},"parent":\{\}\},"pushNotifications":\{"default":\{"isFetching":false,"isDrained":false,"ids":\[\]\},"follow":\{"isFetching":false,"isDrained":false,"ids":\[\]\},"vote\_thank":\{"isFetching":false,"isDrained":false,"ids":\[\]\},"currentTab":"default","notificationsCount":\{"default":0,"follow":0,"vote\_thank":0\}\},"messages":\{"data":\{\},"currentTab":"common","messageCount":0\},"register":\{"registerValidateSucceeded":null,"registerValidateErrors":\{\},"registerConfirmError":null,"sendDigitsError":null,"registerConfirmSucceeded":null\},"login":\{"loginUnregisteredError":false,"loginBindWechatError":false,"loginConfirmError":null,"sendDigitsError":null,"needSMSIdentify":false,"validateDigitsError":false,"loginConfirmSucceeded":null,"qrcodeLoginToken":"","qrcodeLoginScanStatus":0,"qrcodeLoginError":null,"qrcodeLoginReturnNewToken":false\},"switches":\{\},"captcha":\{"captchaNeeded":false,"captchaValidated":false\},"sms":\{"supportedCountries":\[\]\},"chat":\{"chats":\{\},"inbox":\{"recents":\{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":\[\],"next":null,"key":null\},"strangers":\{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":\[\],"next":null,"key":null\},"friends":\{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":\[\],"next":null,"key":null\},"search":\{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":\[\],"next":null,"key":null\},"config":\{"newCount":0,"strangerMessageSwitch":false,"strangerMessageUnread":false,"friendCount":0\}\},"global":\{"isChatMqttExisted":false\}\},"emoticons":\{"emoticonGroupList":\[\],"emoticonGroupDetail":\{\}\},"creator":\{"tools":\{"question":\{"invitationCount":\{"questionFolloweeCount":0,"questionTotalCount":0\}\},"recommend":\{"recommendTimes":\{\}\}\},"explore":\{\},"levelUpperLimit":10,"mcn":\{\},"mcnManage":\{\},"tasks":\{\},"announcement":\{\},"creatorsRecommendInfo":\{\}\},"creators":\{"common":\{"applyStatus":\{\},"rightsStatus":\{\}\},"bayesDomains":\{"status":\{\},"options":\{"topDomains":null,"allDomains":null,"editable":0\},"contents":null\},"school":\{"tabs":\[\],"contents":\[\],"banner":null,"entities":\{\}\},"faq":\{"tabs":\[\],"article":\{\}\},"knowledgeIncome":\{\},"safeguardRights":\{\},"analytics":\{"all":\{\},"answer":\{\},"zvideo":\{\},"article":\{\},"pin":\{\},"singleContent":\{\}\},"account":\{"growthLevel":\{\}\},"KMResource":\{\},"training":\{\},"ToolsQuestion":\{"goodatTopics":\[\]\},"ToolsHotspot":\{"domains":\[\]\},"ToolsRecommend":\{\},"ToolsCustomPromotion":\{"itemLists":\{\},"baseInfo":\{\}\},"ToolsSearchQuestion":\{\},"editorSetting":\{\},"MCNManage":\{\},"knowledgeTasks":\{\},"incomeAnalysis":\{"income":\{"aggregation":\{\}\}\},"creationManage":\{"editModal":\{"status":false\}\},"activity":\{\},"announcement":\{\},"home":\{"currentCreatorUrlToken":null,"rights":\[\],"newRights":\[\],"scoreInfo":\{\},"menusShowControlByServer":\{"bVipRecomend":false,"creationRelationship":false\},"newTasks":\{"creatorTask":\{"tasks":\[\],"des":\[\]\}\},"bannerList":\[\],"recentlyCreated":\[\],"homecard":\{\},"homeData":\{\}\},"videoSupport":\{"textBenefit":\{\}\},"videoDistribution":\{\},"profilePoster":\{"creatorPosterConfig":\{\},"creatorPosterData":\{\}\}\},"answers":\{"voters":\{\},"upvoters":\{\},"copyrightApplicants":\{\},"favlists":\{\},"newAnswer":\{\},"entityWords":\{\},"paidContent":\{\},"settings":\{\},"relationEndorsement":\{\}\},"recommendation":\{"homeRecommendations":\[\]\},"shareTexts":\{\},"articles":\{"voters":\{\},"upvoters":\{\},"relationEndorsement":\{\}\},"previewPost":\{\},"favlists":\{"relations":\{\}\},"columns":\{"voters":\{\}\},"reward":\{"answer":\{\},"article":\{\},"question":\{\}\},"video":\{"data":\{\},"shareVideoDetail":\{\},"last":\{\}\},"topstory":\{"recommend":\{"isFetching":false,"isDrained":false,"afterId":0,"items":\[\],"next":null\},"follow":\{"isFetching":false,"isDrained":false,"afterId":0,"items":\[\],"next":null\},"followWonderful":\{"isFetching":false,"isDrained":false,"afterId":0,"items":\[\],"next":null\},"sidebar":null,"announcement":\{\},"hotList":\[\],"hotListHeadZone":\[\],"guestFeeds":\{"isFetching":false,"isDrained":false,"afterId":0,"items":\[\],"next":null\},"followExtra":\{"isNewUser":null,"isFetched":false,"followCount":0,"followers":\[\]\},"hotDaily":\{"data":\[\],"paging":\{\}\},"hotHighlight":\{"isFetching":false,"isDrained":false,"data":\[\],"paging":\{\}\},"banner":\{\},"commercialBanner":\{"show":false,"banner":\{\},"trackData":\{\}\},"video":\{"items":\[\],"next":null,"isLoading":false,"isDrained":false\}\},"readStatus":\{\},"column":\{\},"requestColumn":\{"categories":\[\],"error":null\},"articleContribution":\{"contributeRequests":\[\],"deleteContributeIdList":\[\],"handledContributeIdList":\[\],"recommendedColumns":\[\],"pinnedColumns":\[\],"sentContributeRequestsIdList":\[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null\]\},"columnContribution":\{"contributeRequests":\[\],"autoInviteEnabled":false,"recommendedContributors":\[\]\},"draftHistory":\{"history":\{\},"drafts":\{\}\},"upload":\{\},"articleDraft":\{"titleImage":"","titleImageSize":\{\},"isTitleImageFullScreen":false,"canTitleImageFullScreen":false,"title":"","titleImageUploading":false,"error":"","content":"","draftLoading":false,"updating":false,"globalLoading":false,"pendingVideo":\{"resource":null,"error":null\},"deleteFail":\{"fail":false\},"recommendTopics":\[\],"selectedColumn":0,"articleDisclaimers":\[\]\},"articleDrafts":\{"isDrained":false,"isLoading":false,"items":\[\]\},"columnAutocomplete":\{"users":\[\],"friends":\[\]\},"columnCollection":\{\},"userProfit":\{"permission":\{"permissionStatus":\{"zhiZixuan":0,"recommend":-1,"task":0,"plugin":0,"infinity":0\},"visible":false\},"linkCardLimit":0\},"mcn":\{"bindInfo":\{\},"memberCategoryList":\[\],"producerList":\[\],"categoryList":\[\],"lists":\{\},"banners":\{\},"protocolStatus":\{"isAgreedNew":true,"isAgreedOld":true\},"probationCountdownDays":0\},"zvideos":\{"campaignVideoList":\{\},"campaigns":\{\},"tagoreCategory":\[\],"recommendations":\{\},"insertable":\{\},"recruit":\{"form":\{"platform":"","nickname":"","followerCount":"","domain":"","contact":""\},"submited":false,"ranking":\[\]\},"qyActivityData":\{\},"talkActivityData":\{\},"party2022ActivityData":\{\},"batchVideos":\{\},"contribution":\{"selectedContribution":null,"campaign":null,"configs":\{\},"contributionLists":\{\},"recommendQuestions":\{"isLoading":true,"paging":\{"isEnd":false,"isStart":true,"totals":0\},"data":\[\]\},"questionSearchResults":\{"isLoading":true,"paging":\{"isEnd":false,"isStart":true,"totals":0\},"data":\[\]\}\},"creationReferences":\{\},"zvideoCollection":\{\},"zvideoGrant":\{\},"collectData":\{"isFetching":false,"list":\[\]\},"videoSource":\{"isLoaded":false\}\},"republish":\{\},"commentPermission":\{\},"creatorRightStatus":\{"list":\[\]\},"adPromotion":\{"answer":\{\},"article":\{\}\}\},"fetchHost":"www.zhihu.com","subAppName":"column","spanName":"EditPage","canaryConfig":\{"test\_canary":"0","use\_new\_player":"0","player\_vendor":"0","use\_hevc":"1","upload\_use\_signature":"1","use\_backdrop\_blur":"1","article\_title\_imagex":"1","play\_station":"1","use\_cached\_supported\_countries":"1"\}\}

_想来知乎工作？请发送邮件到 jobs\@zhihu.com_